<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>4.&nbsp;Jenkins DSL Pipeline</title><link rel="stylesheet" type="text/css" href="css/manual-multipage.css"><meta name="generator" content="DocBook XSL Stylesheets V1.78.1"><link rel="home" href="multi_spring-cloud-pipelines.html" title="Spring Cloud Pipelines"><link rel="up" href="multi_spring-cloud-pipelines.html" title="Spring Cloud Pipelines"><link rel="prev" href="multi_concourse.html" title="3.&nbsp;Concourse Pipeline"><link rel="next" href="multi__the_demo_setup.html" title="5.&nbsp;The demo setup"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">4.&nbsp;Jenkins DSL Pipeline</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="multi_concourse.html">Prev</a>&nbsp;</td><th width="60%" align="center">&nbsp;</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="multi__the_demo_setup.html">Next</a></td></tr></table><hr></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="_jenkins_dsl_pipeline" href="#_jenkins_dsl_pipeline"></a>4.&nbsp;Jenkins DSL Pipeline</h1></div></div></div><p><a name="jenkins" href="#jenkins"></a> The repository contains job definitions and the opinionated setup pipeline using <a class="link" href="https://wiki.jenkins-ci.org/display/JENKINS/Job+DSL+Plugin" target="_top">Jenkins Job Dsl plugin</a>. Those jobs will form an empty pipeline and a sample, opinionated one that you can use in your company.</p><p>All in all there are the following projects taking part in the whole <code class="literal">microservice setup</code> for this demo.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a class="link" href="https://github.com/spring-cloud-samples/github-analytics" target="_top">Github-Analytics</a> - the app that has a REST endpoint and uses messaging. Our business application.</li><li class="listitem"><a class="link" href="https://github.com/spring-cloud-samples/github-webhook" target="_top">Github Webhook</a> - project that emits messages that are used by Github Analytics. Our business application.</li><li class="listitem"><a class="link" href="https://github.com/spring-cloud-samples/github-eureka" target="_top">Eureka</a> - simple Eureka Server. This is an infrastructure application.</li><li class="listitem"><a class="link" href="https://github.com/spring-cloud-samples/github-analytics-stub-runner-boot" target="_top">Github Analytics Stub Runner Boot</a> - Stub Runner Boot server to be used for tests with Github Analytics. Uses Eureka and Messaging. This is an infrastructure application.</li></ul></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_project_setup_2" href="#_project_setup_2"></a>4.1&nbsp;Project setup</h2></div></div></div><pre class="programlisting">.
&#9500;&#9472;&#9472; declarative-pipeline
&#9474;&nbsp;&nbsp; &#9492;&#9472;&#9472; Jenkinsfile-sample.groovy
&#9500;&#9472;&#9472; jobs
&#9474;&nbsp;&nbsp; &#9500;&#9472;&#9472; jenkins_pipeline_empty.groovy
&#9474;&nbsp;&nbsp; &#9500;&#9472;&#9472; jenkins_pipeline_jenkinsfile_empty.groovy
&#9474;&nbsp;&nbsp; &#9500;&#9472;&#9472; jenkins_pipeline_sample.groovy
&#9474;&nbsp;&nbsp; &#9492;&#9472;&#9472; jenkins_pipeline_sample_view.groovy
&#9500;&#9472;&#9472; seed
&#9474;&nbsp;&nbsp; &#9500;&#9472;&#9472; gradle.properties
&#9474;&nbsp;&nbsp; &#9500;&#9472;&#9472; init.groovy
&#9474;&nbsp;&nbsp; &#9500;&#9472;&#9472; jenkins_pipeline.groovy
&#9474;&nbsp;&nbsp; &#9492;&#9472;&#9472; settings.xml
&#9492;&#9472;&#9472; src
    &#9500;&#9472;&#9472; main
 &nbsp;&nbsp; &#9492;&#9472;&#9472; <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">test</span></pre><p>In the <code class="literal">declarative-pipeline</code> you can find a definition of a <code class="literal">Jenkinsfile-sample.groovy</code> declarative
pipeline. It&#8217;s used together with the Blueocean UI.</p><p>In the <code class="literal">jobs</code> folder you have all the seed jobs that will generate pipelines.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><code class="literal">jenkins_pipeline_empty.groovy</code> - is a template of a pipeline with empty steps using the Jenkins Job DSL plugin</li><li class="listitem"><code class="literal">jenkins_pipeline_jenkinsfile_empty.groovy</code> - is a template of a pipeline with empty steps using the Pipeline plugin</li><li class="listitem"><code class="literal">jenkins_pipeline_sample.groovy</code> - is an opinionated implementation using the Jenkins Job DSL plugin</li><li class="listitem"><code class="literal">jenkins_pipeline_sample_view.groovy</code> - builds the views for the pipelines</li></ul></div><p>In the <code class="literal">seed</code> folder you have the <code class="literal">init.groovy</code> file which is executed when Jenkins starts.
That way we can configure most of Jenkins options for you (adding credentials, JDK etc.).
<code class="literal">jenkins_pipeline.groovy</code> contains logic to build a seed job (that way you don&#8217;t have to even click that
job - we generate it for you).</p><p>In the <code class="literal">src</code> folder you have production and test classes needed for you to build your own pipeline.
Currently we have tests only cause the whole logic resides in the <code class="literal">jenkins_pipeline_sample</code> file.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_step_by_step_2" href="#_step_by_step_2"></a>4.2&nbsp;Step by step</h2></div></div></div><p>This is a guide for Jenkins JOB Dsl based pipeline.</p><p>If you want to just run the demo as far as possible using PCF Dev and Docker Compose</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a class="link" href="multi__jenkins_dsl_pipeline.html#jenkins_fork">Fork repos</a></li><li class="listitem"><a class="link" href="multi__jenkins_dsl_pipeline.html#jenkins_start">Start Jenkins and Artifactory</a></li><li class="listitem"><a class="link" href="multi__jenkins_dsl_pipeline.html#jenkins_deploy">Deploy infra to Artifactory</a></li><li class="listitem"><a class="link" href="multi__jenkins_dsl_pipeline.html#jenkins_pcfdev">Start PCF Dev (if you don&#8217;t want to use an existing one)</a></li><li class="listitem"><a class="link" href="multi__jenkins_dsl_pipeline.html#jenkins_seed">Run the seed job</a></li><li class="listitem"><a class="link" href="multi__jenkins_dsl_pipeline.html#jenkins_pipeline">Run the <code class="literal">github-webhook</code> pipeline</a></li></ul></div><p>Below you can find <a class="link" href="">optional</a> steps needed to be taken when you want to customize the pipeline</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a class="link" href="">Setup Jenkins env vars (if you want to use the demo defaults and you&#8217;re using Docker Machine
just check out the section on how to update the URL to Artifactory)</a></li><li class="listitem"><a class="link" href="multi__jenkins_dsl_pipeline.html#jenkins_settings">Add <code class="literal">settings.xml</code> for Jenkins' master (you can skip this if you want to use our defaults)</a></li><li class="listitem"><a class="link" href="">Setup Jenkins miscs (JDK installation, Groovy macro processing etc.)</a></li><li class="listitem"><a class="link" href="multi__jenkins_dsl_pipeline.html#jenkins_credentials">Setup Jenkins credentials</a></li></ul></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_fork_repos_2" href="#_fork_repos_2"></a>4.2.1&nbsp;Fork repos</h3></div></div></div><p><a name="jenkins_fork" href="#jenkins_fork"></a> There are 4 apps that are composing the pipeline</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a class="link" href="https://github.com/spring-cloud-samples/github-webhook" target="_top">Github Webhook</a></li><li class="listitem"><a class="link" href="https://github.com/spring-cloud-samples/github-analytics/" target="_top">Github Analytics</a></li><li class="listitem"><a class="link" href="https://github.com/spring-cloud-samples/github-eureka" target="_top">Github Eureka</a></li><li class="listitem"><a class="link" href="https://github.com/spring-cloud-samples/github-analytics-stub-runner-boot" target="_top">Github Stub Runner Boot</a></li></ul></div><p>You need to fork only these. That&#8217;s because only then will your user be able to tag and push the tag to repo.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a class="link" href="https://github.com/spring-cloud-samples/github-webhook" target="_top">Github Webhook</a></li><li class="listitem"><a class="link" href="https://github.com/spring-cloud-samples/github-analytics/" target="_top">Github Analytics</a></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_start_jenkins_and_artifactory" href="#_start_jenkins_and_artifactory"></a>4.2.2&nbsp;Start Jenkins and Artifactory</h3></div></div></div><p><a name="jenkins_start" href="#jenkins_start"></a> Jenkins + Artifactory can be ran locally. To do that just execute the
<code class="literal">start.sh</code> script from this repo.</p><pre class="programlisting">git clone https://github.com/spring-cloud/spring-cloud-pipelines
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">cd</span> spring-cloud-pipelines/jenkins
./start.sh yourGitUsername yourGitPassword yourForkedGithubOrg</pre><p>Then Jenkins will be running on port <code class="literal">8080</code> and Artifactory <code class="literal">8081</code>.
The provided parameters will be passed as env variables to Jenkins VM
and credentials will be set in your set. That way you don&#8217;t have to do
any manual work on the Jenkins side. In the above parameters, the third parameter
could be yourForkedGithubOrg or yourGithubUsername. Also the <code class="literal">REPOS</code> env variable will
contain your GitHub org in which you have the forked repos.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_deploy_the_infra_jars_to_artifactory_2" href="#_deploy_the_infra_jars_to_artifactory_2"></a>Deploy the infra JARs to Artifactory</h4></div></div></div><p><a name="jenkins_deploy" href="#jenkins_deploy"></a> When Artifactory is running, just execute the <code class="literal">tools/deploy-infra.sh</code> script from this repo.</p><pre class="programlisting">git clone https://github.com/spring-cloud/spring-cloud-pipelines
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">cd</span> spring-cloud-pipelines/
./tools/deploy-infra.sh</pre><p>As a result both <code class="literal">eureka</code> and <code class="literal">stub runner</code> repos will be cloned, built
and uploaded to Artifactory.</p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_start_pcf_dev_2" href="#_start_pcf_dev_2"></a>4.2.3&nbsp;Start PCF Dev</h3></div></div></div><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>You can skip this step if you have CF installed and don&#8217;t want to use PCF Dev
The only thing you have to do is to set up spaces.</p></td></tr></table></div><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Warning"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Warning]" src="images/warning.png"></td><th align="left">Warning</th></tr><tr><td align="left" valign="top"><p>It&#8217;s more than likely that you&#8217;ll run out of resources when you reach stage step.
Don&#8217;t worry! Keep calm and <a class="link" href="multi_concourse.html#resources">clear some apps from PCF Dev and continue</a>.</p></td></tr></table></div><p><a name="jenkins_pcfdev" href="#jenkins_pcfdev"></a> You have to download and start PCF Dev. <a class="link" href="https://pivotal.io/platform/pcf-tutorials/getting-started-with-pivotal-cloud-foundry-dev/install-pcf-dev" target="_top">A link how to do it is available here.</a></p><p>The default credentials when using PCF Dev are:</p><pre class="programlisting">username: user
password: pass
email: user
org: pcfdev-org
space: pcfdev-space
api: api.local.pcfdev.io</pre><p>You can start the PCF dev like this:</p><pre class="programlisting">cf dev start</pre><p>You&#8217;ll have to create 3 separate spaces (email admin, pass admin)</p><pre class="programlisting">cf login -a https://api.local.pcfdev.io --skip-ssl-validation -u admin -p admin -o pcfdev-org

cf create-space pcfdev-<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">test</span>
cf <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">set</span>-space-role user pcfdev-org pcfdev-<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">test</span> SpaceDeveloper
cf create-space pcfdev-stage
cf <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">set</span>-space-role user pcfdev-org pcfdev-stage SpaceDeveloper
cf create-space pcfdev-prod
cf <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">set</span>-space-role user pcfdev-org pcfdev-prod SpaceDeveloper</pre><p>You can also execute the <code class="literal">./tools/pcfdev-helper.sh setup-spaces</code> to do this.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_run_the_seed_job" href="#_run_the_seed_job"></a>4.2.4&nbsp;Run the seed job</h3></div></div></div><p><a name="jenkins_seed" href="#jenkins_seed"></a> We already create the seed job for you but you&#8217;ll have to run it. When you do
run it you have to provide some properties. By default we create a seed that
has all the properties options, but you can delete most of it. If you
set the properties as global env variables you have to remove them from the
seed.</p><p>Anyways, to run the demo just provide in the <code class="literal">REPOS</code> var the comma separated
 list of URLs of the 2 aforementioned forks of <code class="literal">github-webhook</code> and `github-analytics'.</p><p>&nbsp;
&nbsp;</p><div class="figure"><a name="d0e1957" href="#d0e1957"></a><p class="title"><b>Figure&nbsp;4.1.&nbsp;Click the 'jenkins-pipeline-seed' job</b></p><div class="figure-contents"><div class="mediaobject"><img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-pipelines/master/docs-sources/src/main/asciidoc/images/jenkins/seed_click.png" alt="seed click"></div></div></div><br class="figure-break"><p>&nbsp;
&nbsp;</p><div class="figure"><a name="d0e1968" href="#d0e1968"></a><p class="title"><b>Figure&nbsp;4.2.&nbsp;Click the 'Build with parameters'</b></p><div class="figure-contents"><div class="mediaobject"><img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-pipelines/master/docs-sources/src/main/asciidoc/images/jenkins/seed_run.png" alt="seed run"></div></div></div><br class="figure-break"><p>&nbsp;
&nbsp;</p><div class="figure"><a name="d0e1979" href="#d0e1979"></a><p class="title"><b>Figure&nbsp;4.3.&nbsp;Provide the <code class="literal">REPOS</code> parameter with URLs of your forks (you&#8217;ll have more properties than the ones in the screenshot)</b></p><div class="figure-contents"><div class="mediaobject"><img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-pipelines/master/docs-sources/src/main/asciidoc/images/jenkins/seed.png" alt="seed"></div></div></div><br class="figure-break"><p>&nbsp;
&nbsp;</p><div class="figure"><a name="d0e1993" href="#d0e1993"></a><p class="title"><b>Figure&nbsp;4.4.&nbsp;This is how the results of seed should look like</b></p><div class="figure-contents"><div class="mediaobject"><img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-pipelines/master/docs-sources/src/main/asciidoc/images/jenkins/seed_built.png" alt="seed built"></div></div></div><br class="figure-break"></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_run_the_literal_github_webhook_literal_pipeline_2" href="#_run_the_literal_github_webhook_literal_pipeline_2"></a>4.2.5&nbsp;Run the <code class="literal">github-webhook</code> pipeline</h3></div></div></div><p><a name="jenkins_pipeline" href="#jenkins_pipeline"></a> We already create the seed job for you but you&#8217;ll have to run it. When you do
run it you have to provide some properties. By default we create a seed that
has all the properties options, but you can delete most of it. If you
set the properties as global env variables you have to remove them from the
seed.</p><p>Anyways, to run the demo just provide in the <code class="literal">REPOS</code> var the comma separated
 list of URLs of the 2 aforementioned forks of <code class="literal">github-webhook</code> and <code class="literal">github-analytics</code>.</p><p>&nbsp;
&nbsp;</p><div class="figure"><a name="d0e2024" href="#d0e2024"></a><p class="title"><b>Figure&nbsp;4.5.&nbsp;Click the 'github-webhook' view</b></p><div class="figure-contents"><div class="mediaobject"><img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-pipelines/master/docs-sources/src/main/asciidoc/images/jenkins/seed_views.png" alt="seed views"></div></div></div><br class="figure-break"><p>&nbsp;
&nbsp;</p><div class="figure"><a name="d0e2035" href="#d0e2035"></a><p class="title"><b>Figure&nbsp;4.6.&nbsp;Run the pipeline</b></p><div class="figure-contents"><div class="mediaobject"><img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-pipelines/master/docs-sources/src/main/asciidoc/images/jenkins/pipeline_run.png" alt="pipeline run"></div></div></div><br class="figure-break"><p>&nbsp;
&nbsp;</p><div class="figure"><a name="d0e2046" href="#d0e2046"></a><p class="title"><b>Figure&nbsp;4.7.&nbsp;You can set some properties (just click 'Build' to proceed) </b></p><div class="figure-contents"><div class="mediaobject"><img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-pipelines/master/docs-sources/src/main/asciidoc/images/jenkins/pipeline_run_props.png" alt="pipeline run props"></div></div></div><br class="figure-break"><p>&nbsp;
&nbsp;</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="images/important.png"></td><th align="left">Important</th></tr><tr><td align="left" valign="top"><p>Most likely your 1st build will suddenly hang for 10 minutes. If you rerun it
again it should work after 2-3 minutes. My guess is that it&#8217;s related to Docker Compose
so sorry for this unfortunate situation.</p></td></tr></table></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="images/important.png"></td><th align="left">Important</th></tr><tr><td align="left" valign="top"><p>If your build fails on the <span class="strong"><strong>deploy previous version to stage</strong></span> due to missing jar,
that means that you&#8217;ve forgotten to clear the tags in your repo. Typically that&#8217;s due to the fact that
you&#8217;ve removed the Artifactory volume with deployed JAR whereas a tag in the repo is still pointing there.
<a class="link" href="">Check out this section on how to remove the tag.</a></p></td></tr></table></div><p>&nbsp;
&nbsp;</p><div class="figure"><a name="d0e2070" href="#d0e2070"></a><p class="title"><b>Figure&nbsp;4.8.&nbsp;Click the manual step to go to stage (remember about killing the apps on test env). To do this click the <span class="strong">ARROW</span> next to the job name</b></p><div class="figure-contents"><div class="mediaobject"><img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-pipelines/master/docs-sources/src/main/asciidoc/images/jenkins/pipeline_manual.png" alt="pipeline manual"></div></div></div><br class="figure-break"><p>&nbsp;
&nbsp;</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="images/important.png"></td><th align="left">Important</th></tr><tr><td align="left" valign="top"><p>Most likely you will run out of memory so when reaching the stage
environment it&#8217;s good to kill all apps on test. <a class="link" href="multi_concourse.html#faq" title="3.2.1&nbsp;Can I use the pipeline for some other repos?">Check out the FAQ section for more details</a>!</p></td></tr></table></div><p>&nbsp;
&nbsp;</p><div class="figure"><a name="d0e2092" href="#d0e2092"></a><p class="title"><b>Figure&nbsp;4.9.&nbsp;The full pipeline should look like this</b></p><div class="figure-contents"><div class="mediaobject"><img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-pipelines/master/docs-sources/src/main/asciidoc/images/jenkins/pipeline_finished.png" alt="pipeline finished"></div></div></div><br class="figure-break"><p>&nbsp;
&nbsp;</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_declarative_pipeline_blue_ocean" href="#_declarative_pipeline_blue_ocean"></a>4.3&nbsp;Declarative pipeline &amp; Blue Ocean</h2></div></div></div><p>You can also use the <a class="link" href="https://jenkins.io/doc/book/pipeline/syntax/" target="_top">declarative pipeline</a> approach with the
<a class="link" href="https://jenkins.io/projects/blueocean/" target="_top">Blue Ocean UI</a>. Here is a step by step guide to run a pipeline via
this approach.</p><p>The Blue Ocean UI is available under the <code class="literal">blue/</code> URL. E.g. for Docker Machine based setup <code class="literal"><a class="link" href="http://192.168.99.100:8080/blue" target="_top">http://192.168.99.100:8080/blue</a></code>.</p><p>&nbsp;
&nbsp;</p><div class="figure"><a name="d0e2125" href="#d0e2125"></a><p class="title"><b>Figure&nbsp;4.10.&nbsp;Open Blue Ocean UI and click on <code class="literal">github-webhook-declarative-pipeline</code></b></p><div class="figure-contents"><div class="mediaobject"><img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-pipelines/master/docs-sources/src/main/asciidoc/images/jenkins/blue_1.png" alt="blue 1"></div></div></div><br class="figure-break"><p>&nbsp;
&nbsp;</p><div class="figure"><a name="d0e2138" href="#d0e2138"></a><p class="title"><b>Figure&nbsp;4.11.&nbsp;Your first run will look like this. Click <code class="literal">Run</code> button</b></p><div class="figure-contents"><div class="mediaobject"><img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-pipelines/master/docs-sources/src/main/asciidoc/images/jenkins/blue_2.png" alt="blue 2"></div></div></div><br class="figure-break"><p>&nbsp;
&nbsp;</p><div class="figure"><a name="d0e2152" href="#d0e2152"></a><p class="title"><b>Figure&nbsp;4.12.&nbsp;Enter parameters required for the build and click <code class="literal">run</code></b></p><div class="figure-contents"><div class="mediaobject"><img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-pipelines/master/docs-sources/src/main/asciidoc/images/jenkins/blue_3.png" alt="blue 3"></div></div></div><br class="figure-break"><p>&nbsp;
&nbsp;</p><div class="figure"><a name="d0e2165" href="#d0e2165"></a><p class="title"><b>Figure&nbsp;4.13.&nbsp;A list of pipelines will be shown. Click your first run.</b></p><div class="figure-contents"><div class="mediaobject"><img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-pipelines/master/docs-sources/src/main/asciidoc/images/jenkins/blue_4.png" alt="blue 4"></div></div></div><br class="figure-break"><p>&nbsp;
&nbsp;</p><div class="figure"><a name="d0e2176" href="#d0e2176"></a><p class="title"><b>Figure&nbsp;4.14.&nbsp;State if you want to go to production or not and click <code class="literal">Proceed</code></b></p><div class="figure-contents"><div class="mediaobject"><img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-pipelines/master/docs-sources/src/main/asciidoc/images/jenkins/blue_5.png" alt="blue 5"></div></div></div><br class="figure-break"><p>&nbsp;
&nbsp;</p><div class="figure"><a name="d0e2189" href="#d0e2189"></a><p class="title"><b>Figure&nbsp;4.15.&nbsp;The build is in progress&#8230;&#8203;</b></p><div class="figure-contents"><div class="mediaobject"><img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-pipelines/master/docs-sources/src/main/asciidoc/images/jenkins/blue_6.png" alt="blue 6"></div></div></div><br class="figure-break"><p>&nbsp;
&nbsp;</p><div class="figure"><a name="d0e2200" href="#d0e2200"></a><p class="title"><b>Figure&nbsp;4.16.&nbsp;The pipeline is done!</b></p><div class="figure-contents"><div class="mediaobject"><img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-pipelines/master/docs-sources/src/main/asciidoc/images/jenkins/blue_7.png" alt="blue 7"></div></div></div><br class="figure-break"><p>&nbsp;
&nbsp;</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="images/important.png"></td><th align="left">Important</th></tr><tr><td align="left" valign="top"><p>There is no possibility of restarting pipeline from specific stage, after failure. Please
check out this <a class="link" href="https://issues.jenkins-ci.org/browse/JENKINS-33846" target="_top">issue</a> for more information</p></td></tr></table></div><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Warning"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Warning]" src="images/warning.png"></td><th align="left">Warning</th></tr><tr><td align="left" valign="top"><p>Currently there is no way to introduce manual steps in a performant way. Jenkins is
blocking an executor when manual step is required. That means that you&#8217;ll run out of executors
pretty fast. You can check out this <a class="link" href="https://issues.jenkins-ci.org/browse/JENKINS-36235" target="_top">issue</a> for
and this <a class="link" href="http://stackoverflow.com/questions/42561241/how-to-wait-for-user-input-in-a-declarative-pipeline-without-blocking-a-heavywei" target="_top">StackOverflow question</a>
for more information.</p></td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_optional_steps" href="#_optional_steps"></a>4.4&nbsp;Optional steps</h2></div></div></div><p><a name="jenkins_optional" href="#jenkins_optional"></a> All the steps below are not necessary to run the demo. They are needed only
when you want to do some custom changes.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_deploying_infra_jars_to_a_different_location" href="#_deploying_infra_jars_to_a_different_location"></a>4.4.1&nbsp;Deploying infra jars to a different location</h3></div></div></div><p>It&#8217;s enough to set the <code class="literal">ARTIFACTORY_URL</code> environmental variable before
executing <code class="literal">tools/deploy-infra.sh</code>. Example for deploying to Artifactory at IP <code class="literal">192.168.99.100</code></p><pre class="programlisting">git clone https://github.com/spring-cloud/spring-cloud-pipelines
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">cd</span> spring-cloud-pipelines/
ARTIFACTORY_URL=<span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"http://192.168.99.100:8081/artifactory/libs-release-local"</span> ./tools/deploy-infra.sh</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_setup_settings_xml_for_maven_deployment" href="#_setup_settings_xml_for_maven_deployment"></a>4.4.2&nbsp;Setup settings.xml for Maven deployment</h3></div></div></div><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>If you want to use the default connection to the Docker version
of Artifactory you can skip this step</p></td></tr></table></div><p><a name="jenkins_settings" href="#jenkins_settings"></a> So that <code class="literal">./mvnw deploy</code> works with Artifactory from Docker we&#8217;re
already copying the missing <code class="literal">settings.xml</code> file for you. It looks like this:</p><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-tag">&lt;server&gt;</span>
  <span xmlns:d="http://docbook.org/ns/docbook" class="hl-tag">&lt;id&gt;</span>artifactory-local<span xmlns:d="http://docbook.org/ns/docbook" class="hl-tag">&lt;/id&gt;</span>
  <span xmlns:d="http://docbook.org/ns/docbook" class="hl-tag">&lt;username&gt;</span>admin<span xmlns:d="http://docbook.org/ns/docbook" class="hl-tag">&lt;/username&gt;</span>
  <span xmlns:d="http://docbook.org/ns/docbook" class="hl-tag">&lt;password&gt;</span>password<span xmlns:d="http://docbook.org/ns/docbook" class="hl-tag">&lt;/password&gt;</span>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-tag">&lt;/server&gt;</span></pre><p>If you want to use your own version of Artifactory / Nexus you have to update
the file (it&#8217;s in <code class="literal">seed/settings.xml</code>).</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_setup_jenkins_env_vars" href="#_setup_jenkins_env_vars"></a>4.4.3&nbsp;Setup Jenkins env vars</h3></div></div></div><p><a name="jenkins_env" href="#jenkins_env"></a> If you want to only play around with the demo that we&#8217;ve prepared you have to set <span class="strong"><strong>ONE</strong></span> variable which is the <code class="literal">REPOS</code> variable.
That variable needs to consists of comma separated list of URLs to repositories containing business apps. So you should pass your forked repos URLs.</p><p>You can do it in the following ways:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">globally via Jenkins global env vars (then when you run the seed that variable will be taken into consideration and proper pipelines will get built)</li><li class="listitem">modify the seed job parameters (you&#8217;ll have to modify the seed job configuration and change the <code class="literal">REPOS</code> property)</li><li class="listitem">provide the repos parameter when running the seed job</li></ul></div><p>For the sake of simplicity let&#8217;s go with the <span class="strong"><strong>last</strong></span> option.</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="images/important.png"></td><th align="left">Important</th></tr><tr><td align="left" valign="top"><p>If you&#8217;re choosing the global envs, you <span class="strong"><strong>HAVE</strong></span> to remove the other approach
(e.g. if you set the global env for <code class="literal">REPOS</code>, please remove that property in the
seed job</p></td></tr></table></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_seed_properties" href="#_seed_properties"></a>Seed properties</h4></div></div></div><p>Click on the seed job and pick <code class="literal">Build with parameters</code>. Then as presented in the screen below (you&#8217;ll have far more properties to set) just modify the <code class="literal">REPOS</code> property by providing the comma separated list of URLs to your forks. Whatever you set will be parsed by the seed job and passed to the generated Jenkins jobs.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>This is very useful when the repos you want to build differ. E.g. use
different JDK. Then some seeds can set the <code class="literal">JDK_VERSION</code> param to one version
of Java installation and the others to another one.</p></td></tr></table></div><p>Example screen:</p><div class="informalfigure"><div class="mediaobject"><img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-pipelines/master/docs-sources/src/main/asciidoc/images/jenkins/seed.png" alt="seed"></div></div><p>In the screenshot we could parametrize the <code class="literal">REPOS</code> and <code class="literal">REPO_WITH_BINARIES</code> params.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_global_envs" href="#_global_envs"></a>Global envs</h4></div></div></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="images/important.png"></td><th align="left">Important</th></tr><tr><td align="left" valign="top"><p>This section is presented only for informational purposes - for the sake of demo you can skip it</p></td></tr></table></div><p>You can add env vars (go to configure Jenkins &#8594; Global Properties) for the following
 properties (the defaults are for PCF Dev):</p><p>Example screen:</p><div class="informalfigure"><div class="mediaobject"><img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-pipelines/master/docs-sources/src/main/asciidoc/images/jenkins/env_vars.png" alt="env vars"></div></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_all_env_vars" href="#_all_env_vars"></a>All env vars</h4></div></div></div><p>The env vars that are used in all of the jobs are as follows:</p><div class="informaltable"><table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; "><colgroup><col class="col_1"><col class="col_2"><col class="col_3"></colgroup><thead><tr><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">Property Name</th><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">Property Description</th><th style="border-bottom: 0.5pt solid ; " align="left" valign="top">Default value</th></tr></thead><tfoot><tr><th style="border-right: 0.5pt solid ; " align="left" valign="top"><p>BUILD_OPTIONS</p></th><th style="border-right: 0.5pt solid ; " align="left" valign="top"><p>Additional options you would like to pass to the Maven / Gradle build</p></th><th style="" align="left" valign="top">&nbsp;</th></tr></tfoot><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>PAAS_TEST_API_URL</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>The URL to the CF Api for TEST env</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>api.local.pcfdev.io</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>PAAS_STAGE_API_URL</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>The URL to the CF Api for STAGE env</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>api.local.pcfdev.io</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>PAAS_PROD_API_URL</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>The URL to the CF Api for PROD env</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>api.local.pcfdev.io</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>PAAS_TEST_ORG</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Name of the org for the test env</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>pcfdev-org</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>PAAS_TEST_SPACE</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Name of the space for the test env</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>pcfdev-space</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>PAAS_STAGE_ORG</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Name of the org for the stage env</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>pcfdev-org</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>PAAS_STAGE_SPACE</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Name of the space for the stage env</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>pcfdev-space</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>PAAS_PROD_ORG</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Name of the org for the prod env</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>pcfdev-org</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>PAAS_PROD_SPACE</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Name of the space for the prod env</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>pcfdev-space</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>REPO_WITH_BINARIES</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>URL to repo with the deployed jars</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><a class="link" href="http://artifactory:8081/artifactory/libs-release-local" target="_top">http://artifactory:8081/artifactory/libs-release-local</a></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>M2_SETTINGS_REPO_ID</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>The id of server from Maven settings.xml</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>artifactory-local</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>JDK_VERSION</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>The name of the JDK installation</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>jdk8</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>PIPELINE_VERSION</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>What should be the version of the pipeline (ultimately also version of the jar)</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>1.0.0.M1-${GROOVY,script ="new Date().format('yyMMdd_HHmmss')"}-VERSION</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>GIT_EMAIL</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>The email used by Git to tag repo</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><a class="link" href="mailto:email@example.com" target="_top">email@example.com</a></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>GIT_NAME</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>The name used by Git to tag repo</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Pivo Tal</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>PAAS_HOSTNAME_UUID</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Additional suffix for the route. In a shared environment the default routes can be already taken</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top">&nbsp;</td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>AUTO_DEPLOY_TO_STAGE</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Should deployment to stage be automatic</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>false</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>AUTO_DEPLOY_TO_PROD</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Should deployment to prod be automatic</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>false</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>ROLLBACK_STEP_REQUIRED</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Should rollback step be present</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>true</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>DEPLOY_TO_STAGE_STEP_REQUIRED</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Should deploy to stage step be present</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>true</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>APP_MEMORY_LIMIT</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>How much memory should be used by the infra apps (Eureka, Stub Runner etc.)</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>256m</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>JAVA_BUILDPACK_URL</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>The URL to the Java buildpack to be used by CF</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><a class="link" href="https://github.com/cloudfoundry/java-buildpack.git#v3.8.1" target="_top">https://github.com/cloudfoundry/java-buildpack.git#v3.8.1</a></p></td></tr></tbody></table></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_set_git_email_user" href="#_set_git_email_user"></a>4.4.4&nbsp;Set Git email / user</h3></div></div></div><p>Since our pipeline is setting the git user / name explicitly for the build step
 you&#8217;d have to go to <code class="literal">Configure</code> of the build step and modify the Git name / email.
 If you want to set it globally you&#8217;ll have to remove the section from the build
 step and follow these steps to set it globally.</p><p>You can set Git email / user globally like this:</p><p>&nbsp;
&nbsp;</p><div class="figure"><a name="d0e2622" href="#d0e2622"></a><p class="title"><b>Figure&nbsp;4.17.&nbsp;Click 'Manage Jenkins'</b></p><div class="figure-contents"><div class="mediaobject"><img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-pipelines/master/docs-sources/src/main/asciidoc/images/jenkins/manage_jenkins.png" alt="manage jenkins"></div></div></div><br class="figure-break"><p>&nbsp;
&nbsp;</p><div class="figure"><a name="d0e2633" href="#d0e2633"></a><p class="title"><b>Figure&nbsp;4.18.&nbsp;Click 'Configure System'</b></p><div class="figure-contents"><div class="mediaobject"><img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-pipelines/master/docs-sources/src/main/asciidoc/images/jenkins/configure_system.png" alt="configure system"></div></div></div><br class="figure-break"><p>&nbsp;
&nbsp;</p><div class="figure"><a name="d0e2644" href="#d0e2644"></a><p class="title"><b>Figure&nbsp;4.19.&nbsp;Fill out Git user information</b></p><div class="figure-contents"><div class="mediaobject"><img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-pipelines/master/docs-sources/src/main/asciidoc/images/jenkins/git.png" alt="git"></div></div></div><br class="figure-break"><p>&nbsp;
&nbsp;</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_jenkins_credentials" href="#_jenkins_credentials"></a>4.4.5&nbsp;Jenkins Credentials</h3></div></div></div><p>In your scripts we reference the credentials via IDs. These are the defaults for credentials</p><div class="informaltable"><table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; "><colgroup><col class="col_1"><col class="col_2"><col class="col_3"></colgroup><thead><tr><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">Property Name</th><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">Property Description</th><th style="border-bottom: 0.5pt solid ; " align="left" valign="top">Default value</th></tr></thead><tfoot><tr><th style="border-right: 0.5pt solid ; " align="left" valign="top"><p>PAAS_PROD_CREDENTIAL_ID</p></th><th style="border-right: 0.5pt solid ; " align="left" valign="top"><p>Credential ID for CF Prod env access</p></th><th style="" align="left" valign="top"><p>cf-prod</p></th></tr></tfoot><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>GIT_CREDENTIAL_ID</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Credential ID used to tag a git repo</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>git</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>REPO_WITH_BINARIES_CREDENTIALS_ID</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Credential ID used for the repo with jars</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>repo-with-binaries</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>PAAS_TEST_CREDENTIAL_ID</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Credential ID for CF Test env access</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>cf-test</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>PAAS_STAGE_CREDENTIAL_ID</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Credential ID for CF Stage env access</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>cf-stage</p></td></tr></tbody></table></div><p>If you already have in your system a credential to for example tag a repo
you can use it by passing the value of the property <code class="literal">GIT_CREDENTIAL_ID</code></p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_add_jenkins_credentials_for_github" href="#_add_jenkins_credentials_for_github"></a>Add Jenkins credentials for GitHub</h4></div></div></div><p><a name="jenkins_credentials" href="#jenkins_credentials"></a> The scripts will need to access the credential in order to tag the repo.</p><p>You have to set credentials with id: <code class="literal">git</code>.</p><p>Below you can find instructions on how to set a credential (e.g. for <code class="literal">cf-test</code> credential but
remember to provide the one with id <code class="literal">git</code>).</p><p>&nbsp;
&nbsp;</p><div class="figure"><a name="d0e2750" href="#d0e2750"></a><p class="title"><b>Figure&nbsp;4.20.&nbsp;Click 'Credentials, System'</b></p><div class="figure-contents"><div class="mediaobject"><img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-pipelines/master/docs-sources/src/main/asciidoc/images/jenkins/credentials_system.png" alt="credentials system"></div></div></div><br class="figure-break"><p>&nbsp;
&nbsp;</p><div class="figure"><a name="d0e2761" href="#d0e2761"></a><p class="title"><b>Figure&nbsp;4.21.&nbsp;Click 'Global Credentials'</b></p><div class="figure-contents"><div class="mediaobject"><img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-pipelines/master/docs-sources/src/main/asciidoc/images/jenkins/credentials_global.png" alt="credentials global"></div></div></div><br class="figure-break"><p>&nbsp;
&nbsp;</p><div class="figure"><a name="d0e2772" href="#d0e2772"></a><p class="title"><b>Figure&nbsp;4.22.&nbsp;Click 'Add credentials'</b></p><div class="figure-contents"><div class="mediaobject"><img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-pipelines/master/docs-sources/src/main/asciidoc/images/jenkins/credentials_add.png" alt="credentials add"></div></div></div><br class="figure-break"><p>&nbsp;
&nbsp;</p><div class="figure"><a name="d0e2783" href="#d0e2783"></a><p class="title"><b>Figure&nbsp;4.23.&nbsp;Fill out the user / password and provide the <code class="literal">git</code> credential ID (in this example <code class="literal">cf-test</code>)</b></p><div class="figure-contents"><div class="mediaobject"><img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-pipelines/master/docs-sources/src/main/asciidoc/images/jenkins/credentials_example.png" alt="credentials example"></div></div></div><br class="figure-break"><p>&nbsp;
&nbsp;</p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_enable_groovy_token_macro_processing" href="#_enable_groovy_token_macro_processing"></a>4.4.6&nbsp;Enable Groovy Token Macro Processing</h3></div></div></div><p>With scripted that but if you needed to this manually then this is how to do it:</p><p>&nbsp;
&nbsp;</p><div class="figure"><a name="d0e2807" href="#d0e2807"></a><p class="title"><b>Figure&nbsp;4.24.&nbsp;Click 'Manage Jenkins'</b></p><div class="figure-contents"><div class="mediaobject"><img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-pipelines/master/docs-sources/src/main/asciidoc/images/jenkins/manage_jenkins.png" alt="manage jenkins"></div></div></div><br class="figure-break"><p>&nbsp;
&nbsp;</p><div class="figure"><a name="d0e2818" href="#d0e2818"></a><p class="title"><b>Figure&nbsp;4.25.&nbsp;Click 'Configure System'</b></p><div class="figure-contents"><div class="mediaobject"><img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-pipelines/master/docs-sources/src/main/asciidoc/images/jenkins/configure_system.png" alt="configure system"></div></div></div><br class="figure-break"><p>&nbsp;
&nbsp;</p><div class="figure"><a name="d0e2829" href="#d0e2829"></a><p class="title"><b>Figure&nbsp;4.26.&nbsp;Click 'Allow token macro processing'</b></p><div class="figure-contents"><div class="mediaobject"><img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-pipelines/master/docs-sources/src/main/asciidoc/images/jenkins/groovy_token.png" alt="groovy token"></div></div></div><br class="figure-break"></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_docker_image" href="#_docker_image"></a>4.5&nbsp;Docker Image</h2></div></div></div><p>If you would like to run the pre-configured Jenkins image somewhere other than your local machine, we
have an image you can pull and use on <a class="link" href="https://hub.docker.com/r/springcloud/spring-cloud-pipeline-jenkins/" target="_top">DockerHub</a>.
The <code class="literal">latest</code> tag corresponds to the latest snapshot build.  You can also find tags
corresponding to stable releases that you can use as well.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_faq_2" href="#_faq_2"></a>4.6&nbsp;FAQ</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="jenkins_faq" href="#jenkins_faq"></a>4.6.1&nbsp;Pipeline version contains ${PIPELINE_VERSION}</h3></div></div></div><p>You can check the Jenkins logs and you&#8217;ll see</p><pre class="programlisting">WARNING: Skipped parameter `PIPELINE_VERSION` as it is undefined on `jenkins-pipeline-sample-build`.
	Set `-Dhudson.model.ParametersAction.keepUndefinedParameters`=true to allow undefined parameters
	to be injected as environment variables or
	`-Dhudson.model.ParametersAction.safeParameters=[comma-separated list]`
	to whitelist specific parameter names, even though it represents a security breach</pre><p>To fix it you have to do exactly what the warning suggests&#8230;&#8203; Also ensure that the <code class="literal">Groovy token macro processing</code>
checkbox is set.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_pipeline_version_is_not_passed_to_the_build" href="#_pipeline_version_is_not_passed_to_the_build"></a>4.6.2&nbsp;Pipeline version is not passed to the build</h3></div></div></div><p>You can see that the Jenkins version is properly set but in the build version is still snapshot and
the <code class="literal">echo "${PIPELINE_VERSION}"</code> doesn&#8217;t print anything.</p><p>You can check the Jenkins logs and you&#8217;ll see</p><pre class="programlisting">WARNING: Skipped parameter `PIPELINE_VERSION` as it is undefined on `jenkins-pipeline-sample-build`.
	Set `-Dhudson.model.ParametersAction.keepUndefinedParameters`=true to allow undefined parameters
	to be injected as environment variables or
	`-Dhudson.model.ParametersAction.safeParameters=[comma-separated list]`
	to whitelist specific parameter names, even though it represents a security breach</pre><p>To fix it you have to do exactly what the warning suggests&#8230;&#8203;</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_the_build_times_out_with_literal_pipeline_sh_literal_info" href="#_the_build_times_out_with_literal_pipeline_sh_literal_info"></a>4.6.3&nbsp;The build times out with <code class="literal">pipeline.sh</code> info</h3></div></div></div><p>Docker compose, docker compose, docker compose&#8230;&#8203; The problem is that for some reason, only in Docker, the execution of
Java hangs. But it hangs randomly and only the first time you try to execute the pipeline.</p><p>The solution to this is to run the pipeline again. If once it suddenly, magically passes then
it will pass for any subsequent build.</p><p>Another thing that you can try is to run it with plain Docker. Maybe that will help.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_can_i_use_the_pipeline_for_some_other_repos" href="#_can_i_use_the_pipeline_for_some_other_repos"></a>4.6.4&nbsp;Can I use the pipeline for some other repos?</h3></div></div></div><p>Sure! you can pass <code class="literal">REPOS</code> variable with comma separated list of
<code class="literal">project_name$project_url</code> format. If you don&#8217;t provide the PROJECT_NAME the
repo name will be extracted and used as the name of the project.</p><p>E.g. for <code class="literal">REPOS</code> equal to:</p><p><code class="literal"><a class="link" href="https://github.com/spring-cloud-samples/github-analytics,https://github.com/spring-cloud-samples/github-webhook" target="_top">https://github.com/spring-cloud-samples/github-analytics,https://github.com/spring-cloud-samples/github-webhook</a></code></p><p>will result in the creation of pipelines with root names <code class="literal">github-analytics</code> and <code class="literal">github-webhook</code>.</p><p>E.g. for <code class="literal">REPOS</code> equal to:</p><p><code class="literal">foo$https://github.com/spring-cloud-samples/github-analytics,bar$https://github.com/spring-cloud-samples/atom-feed</code></p><p>will result in the creation of pipelines with root names <code class="literal">foo</code> for <code class="literal">github-analytics</code>
and <code class="literal">bar</code> for <code class="literal">github-webhook</code>.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_will_this_work_for_any_project_out_of_the_box_2" href="#_will_this_work_for_any_project_out_of_the_box_2"></a>4.6.5&nbsp;Will this work for ANY project out of the box?</h3></div></div></div><p>Not really. This is an <code class="literal">opinionated pipeline</code> that&#8217;s why we took some
opinionated decisions like:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">usage of Spring Cloud, Spring Cloud Contract Stub Runner and Spring Cloud Eureka</li><li class="listitem">application deployment to Cloud Foundry</li><li class="listitem"><p class="simpara">For Maven:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem">usage of Maven Wrapper</li><li class="listitem">artifacts deployment by <code class="literal">./mvnw clean deploy</code></li><li class="listitem"><code class="literal">stubrunner.ids</code> property to retrieve list of collaborators for which stubs should be downloaded</li><li class="listitem">running smoke tests on a deployed app via the <code class="literal">smoke</code> Maven profile</li><li class="listitem">running end to end tests on a deployed app via the <code class="literal">e2e</code> Maven profile</li></ul></div></li><li class="listitem"><p class="simpara">For Gradle (in the <code class="literal">github-analytics</code> application check the <code class="literal">gradle/pipeline.gradle</code> file):</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem">usage of Gradlew Wrapper</li><li class="listitem"><code class="literal">deploy</code> task for artifacts deployment</li><li class="listitem">running smoke tests on a deployed app via the <code class="literal">smoke</code> task</li><li class="listitem">running end to end tests on a deployed app via the <code class="literal">e2e</code> task</li><li class="listitem"><code class="literal">groupId</code> task to retrieve group id</li><li class="listitem"><code class="literal">artifactId</code> task to retrieve artifact id</li><li class="listitem"><code class="literal">currentVersion</code> task to retrieve the current version</li><li class="listitem"><code class="literal">stubIds</code> task to retrieve list of collaborators for which stubs should be downloaded</li></ul></div></li></ul></div><p>This is the initial approach that can be easily changed in the future.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_can_i_modify_this_to_reuse_in_my_project_2" href="#_can_i_modify_this_to_reuse_in_my_project_2"></a>4.6.6&nbsp;Can I modify this to reuse in my project?</h3></div></div></div><p>Sure! It&#8217;s open-source! The important thing is that the core part of the logic is written
in Bash scripts. That way, in the majority of cases, you could change only the bash
scripts without changing the whole pipeline.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_i_ran_out_of_resources_2" href="#_i_ran_out_of_resources_2"></a>4.6.7&nbsp;I ran out of resources!!</h3></div></div></div><p>[jenkins_resources]] When deploying the app to stage or prod you can get an exception <code class="literal">Insufficient resources</code>. The way to
 solve it is to kill some apps from test / stage env. To achieve that just call</p><pre class="programlisting">cf target -o pcfdev-org -s pcfdev-<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">test</span>
cf stop github-webhook
cf stop github-eureka
cf stop stubrunner</pre><p>You can also execute <code class="literal">./tools/pcfdev-helper.sh kill-all-apps</code> that will remove all demo-related apps
deployed to PCF dev.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_the_rollback_step_fails_due_to_missing_jar_2" href="#_the_rollback_step_fails_due_to_missing_jar_2"></a>4.6.8&nbsp;The rollback step fails due to missing JAR ?!</h3></div></div></div><p><a name="jenkins_tags" href="#jenkins_tags"></a> You must have pushed some tags and have removed the Artifactory volume that
contained them. To fix this, just remove the tags</p><pre class="programlisting">git tag -l | xargs -n <span class="hl-number">1</span> git push --delete origin</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_i_want_to_provide_a_different_jdk_version" href="#_i_want_to_provide_a_different_jdk_version"></a>4.6.9&nbsp;I want to provide a different JDK version</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">by default we assume that you have jdk with id <code class="literal">jdk8</code> configured</li><li class="listitem">if you want a different one just override <code class="literal">JDK_VERSION</code> env var and point to the proper one</li></ul></div><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>The docker image comes in with Java installed at <code class="literal">/usr/lib/jvm/java-8-openjdk-amd64</code>.
You can go to <code class="literal">Global Tools</code> and create a JDK with <code class="literal">jdk8</code> id and JAVA_HOME
 pointing to <code class="literal">/usr/lib/jvm/java-8-openjdk-amd64</code></p></td></tr></table></div><p>To change the default one just follow these steps:</p><p>&nbsp;
&nbsp;</p><div class="figure"><a name="d0e3098" href="#d0e3098"></a><p class="title"><b>Figure&nbsp;4.27.&nbsp;Click 'Manage Jenkins'</b></p><div class="figure-contents"><div class="mediaobject"><img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-pipelines/master/docs-sources/src/main/asciidoc/images/jenkins/manage_jenkins.png" alt="manage jenkins"></div></div></div><br class="figure-break"><p>&nbsp;
&nbsp;</p><div class="figure"><a name="d0e3109" href="#d0e3109"></a><p class="title"><b>Figure&nbsp;4.28.&nbsp;Click 'Global Tool'</b></p><div class="figure-contents"><div class="mediaobject"><img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-pipelines/master/docs-sources/src/main/asciidoc/images/jenkins/global_tool.png" alt="global tool"></div></div></div><br class="figure-break"><p>&nbsp;
&nbsp;</p><div class="figure"><a name="d0e3120" href="#d0e3120"></a><p class="title"><b>Figure&nbsp;4.29.&nbsp;Click 'JDK Installations'</b></p><div class="figure-contents"><div class="mediaobject"><img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-pipelines/master/docs-sources/src/main/asciidoc/images/jenkins/jdk_installation.png" alt="jdk installation"></div></div></div><br class="figure-break"><p>&nbsp;
&nbsp;</p><div class="figure"><a name="d0e3131" href="#d0e3131"></a><p class="title"><b>Figure&nbsp;4.30.&nbsp;Fill out JDK Installation with path to your JDK</b></p><div class="figure-contents"><div class="mediaobject"><img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-pipelines/master/docs-sources/src/main/asciidoc/images/jenkins/jdk.png" alt="jdk"></div></div></div><br class="figure-break"><p>&nbsp;
&nbsp;</p><p>And that&#8217;s it!</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_i_want_deployment_to_stage_and_prod_be_automatic" href="#_i_want_deployment_to_stage_and_prod_be_automatic"></a>I want deployment to stage and prod be automatic</h4></div></div></div><p>No problem, just set the property / env var to true</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><code class="literal">AUTO_DEPLOY_TO_STAGE</code> to automatically deploy to stage</li><li class="listitem"><code class="literal">AUTO_DEPLOY_TO_PROD</code> to automatically deploy to prod</li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_i_can_t_tag_the_repo" href="#_i_can_t_tag_the_repo"></a>4.6.10&nbsp;I can&#8217;t tag the repo!</h3></div></div></div><p>When you get sth like this:</p><pre class="programlisting"><span class="hl-number">19</span>:<span class="hl-number">01</span>:<span class="hl-number">44</span> stderr: remote: Invalid username or password.
<span class="hl-number">19</span>:<span class="hl-number">01</span>:<span class="hl-number">44</span> fatal: Authentication failed <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">for</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">'https://github.com/marcingrzejszczak/github-webhook/'</span>
<span class="hl-number">19</span>:<span class="hl-number">01</span>:<span class="hl-number">44</span>
<span class="hl-number">19</span>:<span class="hl-number">01</span>:<span class="hl-number">44</span> 	at org.jenkinsci.plugins.gitclient.CliGitAPIImpl.launchCommandIn(CliGitAPIImpl.java:<span class="hl-number">1740</span>)
<span class="hl-number">19</span>:<span class="hl-number">01</span>:<span class="hl-number">44</span> 	at org.jenkinsci.plugins.gitclient.CliGitAPIImpl.launchCommandWithCredentials(CliGitAPIImpl.java:<span class="hl-number">1476</span>)
<span class="hl-number">19</span>:<span class="hl-number">01</span>:<span class="hl-number">44</span> 	at org.jenkinsci.plugins.gitclient.CliGitAPIImpl.access$<span class="hl-number">300</span>(CliGitAPIImpl.java:<span class="hl-number">63</span>)
<span class="hl-number">19</span>:<span class="hl-number">01</span>:<span class="hl-number">44</span> 	at org.jenkinsci.plugins.gitclient.CliGitAPIImpl$<span class="hl-number">8.</span>execute(CliGitAPIImpl.java:<span class="hl-number">1816</span>)
<span class="hl-number">19</span>:<span class="hl-number">01</span>:<span class="hl-number">44</span> 	at hudson.plugins.git.GitPublisher.perform(GitPublisher.java:<span class="hl-number">295</span>)
<span class="hl-number">19</span>:<span class="hl-number">01</span>:<span class="hl-number">44</span> 	at hudson.tasks.BuildStepMonitor$<span class="hl-number">3.</span>perform(BuildStepMonitor.java:<span class="hl-number">45</span>)
<span class="hl-number">19</span>:<span class="hl-number">01</span>:<span class="hl-number">44</span> 	at hudson.model.AbstractBuild$AbstractBuildExecution.perform(AbstractBuild.java:<span class="hl-number">779</span>)
<span class="hl-number">19</span>:<span class="hl-number">01</span>:<span class="hl-number">44</span> 	at hudson.model.AbstractBuild$AbstractBuildExecution.performAllBuildSteps(AbstractBuild.java:<span class="hl-number">720</span>)
<span class="hl-number">19</span>:<span class="hl-number">01</span>:<span class="hl-number">44</span> 	at hudson.model.Build$BuildExecution.post2(Build.java:<span class="hl-number">185</span>)
<span class="hl-number">19</span>:<span class="hl-number">01</span>:<span class="hl-number">44</span> 	at hudson.model.AbstractBuild$AbstractBuildExecution.post(AbstractBuild.java:<span class="hl-number">665</span>)
<span class="hl-number">19</span>:<span class="hl-number">01</span>:<span class="hl-number">44</span> 	at hudson.model.Run.execute(Run.java:<span class="hl-number">1745</span>)
<span class="hl-number">19</span>:<span class="hl-number">01</span>:<span class="hl-number">44</span> 	at hudson.model.FreeStyleBuild.run(FreeStyleBuild.java:<span class="hl-number">43</span>)
<span class="hl-number">19</span>:<span class="hl-number">01</span>:<span class="hl-number">44</span> 	at hudson.model.ResourceController.execute(ResourceController.java:<span class="hl-number">98</span>)
<span class="hl-number">19</span>:<span class="hl-number">01</span>:<span class="hl-number">44</span> 	at hudson.model.Executor.run(Executor.java:<span class="hl-number">404</span>)</pre><p>most likely you&#8217;ve passed a wrong password. Check the <a class="link" href="multi__jenkins_dsl_pipeline.html#jenkins_credentials">credentials</a> section
on how to update your credentials.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_deploying_to_test_stage_prod_fails_error_finding_space" href="#_deploying_to_test_stage_prod_fails_error_finding_space"></a>4.6.11&nbsp;Deploying to test / stage / prod fails - error finding space</h3></div></div></div><p>If you receive a similar exception:</p><pre class="programlisting"><span class="hl-number">20</span>:<span class="hl-number">26</span>:<span class="hl-number">18</span> API endpoint:   https://api.local.pcfdev.io (API version: <span class="hl-number">2.58</span>.<span class="hl-number">0</span>)
<span class="hl-number">20</span>:<span class="hl-number">26</span>:<span class="hl-number">18</span> User:           user
<span class="hl-number">20</span>:<span class="hl-number">26</span>:<span class="hl-number">18</span> Org:            pcfdev-org
<span class="hl-number">20</span>:<span class="hl-number">26</span>:<span class="hl-number">18</span> Space:          No space targeted, use <span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">'cf target -s SPACE'</span>
<span class="hl-number">20</span>:<span class="hl-number">26</span>:<span class="hl-number">18</span> FAILED
<span class="hl-number">20</span>:<span class="hl-number">26</span>:<span class="hl-number">18</span> Error finding space pcfdev-<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">test</span>
<span class="hl-number">20</span>:<span class="hl-number">26</span>:<span class="hl-number">18</span> Space pcfdev-<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">test</span> not found</pre><p>It means that you&#8217;ve forgotten to <a class="link" href="multi__jenkins_dsl_pipeline.html#jenkins_pcfdev">create the spaces</a> in your PCF Dev installation.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_the_route_is_already_in_use_2" href="#_the_route_is_already_in_use_2"></a>4.6.12&nbsp;The route is already in use</h3></div></div></div><p>If you play around with Jenkins / Concourse you might end up with the routes occupied</p><pre class="programlisting">Using route github-webhook-<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">test</span>.local.pcfdev.io
Binding github-webhook-<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">test</span>.local.pcfdev.io to github-webhook...
FAILED
The route github-webhook-<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">test</span>.local.pcfdev.io is already in use.</pre><p>Just delete the routes</p><pre class="programlisting">yes | cf delete-route local.pcfdev.io -n github-webhook-<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">test</span>
yes | cf delete-route local.pcfdev.io -n github-eureka-<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">test</span>
yes | cf delete-route local.pcfdev.io -n stubrunner-<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">test</span>
yes | cf delete-route local.pcfdev.io -n github-webhook-stage
yes | cf delete-route local.pcfdev.io -n github-eureka-stage
yes | cf delete-route local.pcfdev.io -n github-webhook-prod
yes | cf delete-route local.pcfdev.io -n github-eureka-prod</pre><p>You can also execute the <code class="literal">./tools/pcfdev-helper.sh delete-routes</code></p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_i_m_unauthorized_to_deploy_infrastructure_jars_2" href="#_i_m_unauthorized_to_deploy_infrastructure_jars_2"></a>4.6.13&nbsp;I&#8217;m unauthorized to deploy infrastructure jars</h3></div></div></div><p>Most likely you&#8217;ve forgotten to update your local <code class="literal">settings.xml</code> with the Artifactory&#8217;s
setup. Check out <a class="link" href="multi__jenkins_dsl_pipeline.html#jenkins_settings">this section of the docs and update your <code class="literal">settings.xml</code></a>.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_signing_artifacts" href="#_signing_artifacts"></a>4.6.14&nbsp;Signing Artifacts</h3></div></div></div><p>In some cases it may be required that when performing a release that the artifacts be signed
before pushing them to the repository.
To do this you will need to import your GPG keys into the Docker image running Jenkins.
This can be done by placing a file called <code class="literal">public.key</code> containing your public key
and a file called <code class="literal">private.key</code> containing your private key in the <code class="literal">seed</code> directory.
These keys will be imported by the <code class="literal">init.groovy</code> script that is run when Jenkins starts.</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_how_to_build_it" href="#_how_to_build_it"></a>4.7&nbsp;How to build it</h2></div></div></div><p><code class="literal">./gradlew clean build</code></p><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Warning"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Warning]" src="images/warning.png"></td><th align="left">Warning</th></tr><tr><td align="left" valign="top"><p>The ran test only checks if your scripts compile.</p></td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_how_to_work_with_jenkins_job_dsl_plugin" href="#_how_to_work_with_jenkins_job_dsl_plugin"></a>4.8&nbsp;How to work with Jenkins Job DSL plugin</h2></div></div></div><p>Check out the <a class="link" href="https://github.com/jenkinsci/job-dsl-plugin/wiki/Tutorial---Using-the-Jenkins-Job-DSL" target="_top">tutorial</a>.
Provide the link to this repository in your Jenkins installation.</p><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Warning"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Warning]" src="images/warning.png"></td><th align="left">Warning</th></tr><tr><td align="left" valign="top"><p>Remember that views can be overridden that&#8217;s why the suggestion is to contain in one script all the logic needed to build a view
 for a single project (check out that <code class="literal">spring_cloud_views.groovy</code> is building all the <code class="literal">spring-cloud</code> views).</p></td></tr></table></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="multi_concourse.html">Prev</a>&nbsp;</td><td width="20%" align="center">&nbsp;</td><td width="40%" align="right">&nbsp;<a accesskey="n" href="multi__the_demo_setup.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">3.&nbsp;Concourse Pipeline&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="multi_spring-cloud-pipelines.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;5.&nbsp;The demo setup</td></tr></table></div></body></html>